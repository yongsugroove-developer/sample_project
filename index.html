<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GTO Decision Calculator</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <h1>GTO Decision Calculator</h1>
    <p class="subtitle">Card picker + range-based simulation + optional solver fallback for practical decision support.</p>

    <section class="panel">
      <h2 class="section-title">Scenario Setup</h2>
      <div class="grid-two">
        <label>
          Street
          <select id="street">
            <option value="preflop">Preflop</option>
            <option value="flop">Flop</option>
            <option value="turn">Turn</option>
            <option value="river">River</option>
          </select>
        </label>

        <label>
          Opponent Count
          <input id="opponents" type="number" min="1" max="8" value="1" />
        </label>

        <label>
          Pot Odds % (minimum equity to call)
          <input id="potOdds" type="number" min="0" max="100" value="33" aria-describedby="potOddsError" />
          <small id="potOddsError" class="field-error" aria-live="polite" hidden></small>
        </label>

        <label>
          Simulation Iterations
          <input id="iterations" type="number" min="500" max="50000" step="500" value="5000" />
        </label>
      </div>

      <div class="grid-two">
        <label>
          Villain Range (ex. 22+,A2s+,KTs+,QJs,ATo+)
          <input id="villainRange" type="text" value="22+,A2s+,AJo+,KTs+,QJs" />
        </label>

        <div class="range-presets" role="group" aria-label="Villain range presets">
          <span>Range Presets</span>
          <div class="preset-buttons">
            <button type="button" class="ghost preset" data-range="22+,A2s+,AJo+,KTs+,QJs">Default</button>
            <button type="button" class="ghost preset" data-range="22+,A2s+,A2o+,K7s+,KTo+,Q9s+,QTo+,J9s+,T9s,98s">Wide</button>
            <button type="button" class="ghost preset" data-range="66+,ATs+,KQs,AQo+">Tight</button>
          </div>
        </div>
      </div>

      <div class="grid-three">
        <label>
          Hero Position
          <select id="heroPosition">
            <option value="ip">IP</option>
            <option value="oop">OOP</option>
          </select>
        </label>

        <label>
          Effective Stack (bb)
          <input id="stackBb" type="number" min="5" max="300" value="100" aria-describedby="stackBbError" />
          <small id="stackBbError" class="field-error" aria-live="polite" hidden></small>
        </label>

        <label>
          Current Bet Size (% Pot)
          <input id="betSize" type="number" min="0" max="200" value="66" aria-describedby="betSizeError" />
          <small id="betSizeError" class="field-error" aria-live="polite" hidden></small>
        </label>
      </div>

      <div class="card-pickers">
        <div>
          <h3>Hero Cards</h3>
          <div id="heroSlots" class="slots"></div>
        </div>
        <div>
          <h3>Board Cards</h3>
          <div id="boardSlots" class="slots"></div>
        </div>
      </div>

      <div class="grid-two">
        <label>
          Quick Input (ex. As Kd | Qh Jh 2c)
          <input id="quickInput" type="text" placeholder="As Kd | Qh Jh 2c" />
        </label>

        <label>
          Recent Scenarios
          <select id="historySelect">
            <option value="">Select a saved scenario</option>
          </select>
        </label>
      </div>

      <div class="grid-two">
        <label>
          Analysis Mode
          <select id="mode">
            <option value="hybrid">Hybrid (simulation + local GTO preset)</option>
            <option value="solver">Prefer external GTO solver API</option>
          </select>
        </label>

        <label>
          External Solver API URL (optional)
          <input id="solverUrl" type="text" placeholder="https://your-solver/api/decision" />
        </label>
      </div>

      <button id="runBtn">Run Calculation</button>
      <p id="progressStatus" class="status" role="status" aria-live="polite"></p>
      <p id="error" class="error" aria-live="polite"></p>
    </section>

    <section class="panel result">
      <h2>Result</h2>
      <div class="metric"><span>Equity</span><strong id="equity">-</strong></div>
      <div class="metric"><span>Tie Rate</span><strong id="tie">-</strong></div>
      <div class="metric"><span>Break-even Equity</span><strong id="breakEven">-</strong></div>
      <div class="metric"><span>Equity Edge</span><strong id="edge">-</strong></div>
      <div class="metric"><span>Call EV Delta</span><strong id="ev">-</strong></div>
      <div class="metric"><span>Confidence Range (95% CI)</span><strong id="ci">-</strong></div>
      <div class="metric"><span>Recommended Action</span><strong id="action">-</strong></div>
      <div class="metric"><span>Action Mix</span><strong id="mix">-</strong></div>
      <div class="metric"><span>Reason</span><strong id="reason">-</strong></div>
      <div class="metric"><span>Sampling Mode</span><strong id="samplingMode">-</strong></div>
      <div class="metric"><span>Result Source</span><strong id="source">-</strong></div>
      <div id="precisionBadge" class="badge" hidden>Low sample count may widen the confidence interval.</div>
      <small>If solver URL is provided, API response is used first. On failure, local fallback is used automatically.</small>
    </section>
  </main>

  <dialog id="cardDialog">
    <form method="dialog" class="dialog-header">
      <h3 id="dialogTitle">Select Card</h3>
      <button value="cancel" class="ghost">Close</button>
    </form>
    <div id="deckGrid" class="deck-grid"></div>
  </dialog>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="app.js"></script>
</body>
</html>