<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GTO 확률 계산기</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <h1>GTO 의사결정 계산기</h1>
    <p class="subtitle">카드 선택 + 레인지 기반 시뮬레이션 + 솔버 연동(옵션)으로 더 실전적인 의사결정을 제공합니다.</p>

    <section class="panel">
      <h2 class="section-title">기본 설정</h2>
      <div class="grid-two">
        <label>
          라운드
          <select id="street">
            <option value="preflop">프리플랍</option>
            <option value="flop">플랍</option>
            <option value="turn">턴</option>
            <option value="river">리버</option>
          </select>
        </label>

        <label>
          상대 인원 수
          <input id="opponents" type="number" min="1" max="8" value="1" />
        </label>

        <label>
          팟 오즈 % (콜에 필요한 최소 승률)
          <input id="potOdds" type="number" min="0" max="100" value="33" />
        </label>

        <label>
          시뮬레이션 횟수
          <input id="iterations" type="number" min="500" max="50000" step="500" value="5000" />
        </label>
      </div>

      <div class="grid-two">
        <label>
          상대 레인지 (예: 22+,A2s+,KTs+,QJs,ATo+)
          <input id="villainRange" type="text" value="22+,A2s+,AJo+,KTs+,QJs" />
        </label>

        <div class="range-presets" role="group" aria-label="상대 레인지 프리셋">
          <span>레인지 프리셋</span>
          <div class="preset-buttons">
            <button type="button" class="ghost preset" data-range="22+,A2s+,AJo+,KTs+,QJs">기본</button>
            <button type="button" class="ghost preset" data-range="22+,A2s+,A2o+,K7s+,KTo+,Q9s+,QTo+,J9s+,T9s,98s">넓게</button>
            <button type="button" class="ghost preset" data-range="66+,ATs+,KQs,AQo+">타이트</button>
          </div>
        </div>
      </div>

      <div class="grid-three">
        <label>
          Hero 포지션
          <select id="heroPosition">
            <option value="ip">IP</option>
            <option value="oop">OOP</option>
          </select>
        </label>

        <label>
          유효 스택 (bb)
          <input id="stackBb" type="number" min="5" max="300" value="100" />
        </label>

        <label>
          현재 베팅 사이즈 (% Pot)
          <input id="betSize" type="number" min="0" max="200" value="66" />
        </label>
      </div>

      <div class="card-pickers">
        <div>
          <h3>내 핸드</h3>
          <div id="heroSlots" class="slots"></div>
        </div>
        <div>
          <h3>보드 카드</h3>
          <div id="boardSlots" class="slots"></div>
        </div>
      </div>

      <div class="grid-two">
        <label>
          빠른 입력 (예: As Kd | Qh Jh 2c)
          <input id="quickInput" type="text" placeholder="As Kd | Qh Jh 2c" />
        </label>

        <label>
          최근 시나리오
          <select id="historySelect">
            <option value="">저장된 시나리오 선택</option>
          </select>
        </label>
      </div>

      <div class="grid-two">
        <label>
          분석 모드
          <select id="mode">
            <option value="hybrid">하이브리드 (시뮬레이션 + 로컬 GTO 프리셋)</option>
            <option value="solver">외부 GTO 솔버 API 우선</option>
          </select>
        </label>

        <label>
          외부 GTO 솔버 API URL (선택)
          <input id="solverUrl" type="text" placeholder="https://your-solver/api/decision" />
        </label>
      </div>

      <button id="runBtn">확률 계산하기</button>
      <p id="error" class="error" aria-live="polite"></p>
    </section>

    <section class="panel result">
      <h2>결과</h2>
      <div class="metric"><span>예상 승률</span><strong id="equity">-</strong></div>
      <div class="metric"><span>무승부율</span><strong id="tie">-</strong></div>
      <div class="metric"><span>브레이크이븐 승률</span><strong id="breakEven">-</strong></div>
      <div class="metric"><span>에퀴티 우위</span><strong id="edge">-</strong></div>
      <div class="metric"><span>콜 EV 지표</span><strong id="ev">-</strong></div>
      <div class="metric"><span>오차범위 (95% CI)</span><strong id="ci">-</strong></div>
      <div class="metric"><span>추천 액션</span><strong id="action">-</strong></div>
      <div class="metric"><span>액션 믹스</span><strong id="mix">-</strong></div>
      <div class="metric"><span>추천 근거</span><strong id="reason">-</strong></div>
      <div class="metric"><span>샘플링 기준</span><strong id="samplingMode">-</strong></div>
      <div class="metric"><span>결과 출처</span><strong id="source">-</strong></div>
      <div id="precisionBadge" class="badge" hidden>표본 수가 낮아 오차범위가 넓을 수 있습니다.</div>
      <small>※ 외부 솔버 URL을 입력하면 API 응답을 우선 사용하고, 실패 시 로컬 계산으로 자동 폴백합니다.</small>
    </section>
  </main>

  <dialog id="cardDialog">
    <form method="dialog" class="dialog-header">
      <h3 id="dialogTitle">카드 선택</h3>
      <button value="cancel" class="ghost">닫기</button>
    </form>
    <div id="deckGrid" class="deck-grid"></div>
  </dialog>

  <script src="app.js"></script>
</body>
</html>
